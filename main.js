/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var k=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var Y=Object.prototype.hasOwnProperty;var X=(i,o)=>{for(var e in o)k(i,e,{get:o[e],enumerable:!0})},J=(i,o,e,n)=>{if(o&&typeof o=="object"||typeof o=="function")for(let t of G(o))!Y.call(i,t)&&t!==e&&k(i,t,{get:()=>o[t],enumerable:!(n=j(o,t))||n.enumerable});return i};var Z=i=>J(k({},"__esModule",{value:!0}),i);var le={};X(le,{default:()=>A});module.exports=Z(le);var v=require("obsidian");function $(i,o,e){var t;let n=e!=null?e:(t=this.app.metadataCache.getFileCache(i))==null?void 0:t.frontmatter;if(n)return o.find(r=>{var p;if(r.enabled===!1)return!1;let a=n[r.key];if(a==null)return!1;let s=Array.isArray(a),l=s?a:[a],u=(p=r.matchType)!=null?p:"equals";if(u==="regex"){if(!(r.value instanceof RegExp))return!1;let f=r.value;return l.some(w=>{let b=String(w);return f.lastIndex=0,f.test(b)})}let d=Q(String(r.value),s),m=u==="contains"||u==="starts-with"||u==="ends-with"?d.filter(f=>f.length>0):d;return m.length?l.some(f=>{let w=String(f);return m.some(b=>ee(w,b,u,r.caseInsensitive))}):!1})}function Q(i,o){if(!o)return[i];let e=i.trim(),n=e.split(/\s+/).map(r=>r.trim()).filter(Boolean);if(!n.length)return[e];let t=new Set;return e&&t.add(e),n.forEach(r=>t.add(r)),Array.from(t)}function ee(i,o,e,n){let t=n?i.toLowerCase():i,r=n?o.toLowerCase():o;switch(e){case"contains":return t.includes(r);case"starts-with":return t.startsWith(r);case"ends-with":return t.endsWith(r);case"equals":default:return t===r}}function _(i){return i.map(o=>{var n,t,r;let e=(n=o.matchType)!=null?n:"equals";if(e==="regex"){let a=o.value instanceof RegExp?o.value.source:String(o.value),s=o.value instanceof RegExp?o.value.flags:"";return{key:o.key,matchType:e,value:a,destination:o.destination,enabled:(t=o.enabled)!=null?t:!1,isRegex:!0,flags:s,debug:o.debug,caseInsensitive:o.caseInsensitive}}return{key:o.key,matchType:e,value:String(o.value),destination:o.destination,enabled:(r=o.enabled)!=null?r:!1,debug:o.debug,caseInsensitive:o.caseInsensitive}})}function O(i){return i==="contains"||i==="starts-with"||i==="ends-with"}function M(i){return typeof i.value=="string"&&i.value.trim().length>0}function K(i=[]){let o=[],e=[],n=[];return i.forEach((t,r)=>{var s,l,u;let a=(s=t.matchType)!=null?s:t.isRegex?"regex":"equals";if(a==="regex")try{let d=new RegExp(t.value,t.flags),m={key:t.key,matchType:a,value:d,destination:t.destination,enabled:(l=t.enabled)!=null?l:!1,debug:t.debug,caseInsensitive:t.caseInsensitive};o.push(m),e.push({index:r,rule:m})}catch(d){let m=d instanceof Error?d.message:String(d),p=t.destination?` (destination: "${t.destination}")`:"",f=`[Obsidian Vault Organizer] Failed to deserialize regex for frontmatter rule "${t.key}"${p}: ${m}. Rule will be ignored.`;console.warn(f),n.push({index:r,message:m,rule:{...t,matchType:a},cause:d})}else{let d={key:t.key,matchType:a,value:t.value,destination:t.destination,enabled:(u=t.enabled)!=null?u:!1,debug:t.debug,caseInsensitive:t.caseInsensitive};o.push(d),e.push({index:r,rule:d})}}),{rules:o,successes:e,errors:n}}var E=class extends Error{constructor(o){super(o),this.name=this.constructor.name,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}},V=class extends E{constructor(e,n,t){let r=S(n);super(`Permission denied: Cannot ${r} "${e}"`);this.filePath=e;this.operation=n;this.originalError=t}getUserMessage(){return`Permission denied: Cannot ${S(this.operation)} "${this.filePath}". Check file permissions and try again.`}},z=class extends E{constructor(e,n,t,r,a){let s=S(r),l=n?`Cannot ${s} "${e}" to "${n}"`:`Cannot ${s} "${e}"`;super(`File conflict: ${l} - file ${t}`);this.sourcePath=e;this.destinationPath=n;this.conflictType=t;this.operation=r;this.originalError=a}getUserMessage(){let e={exists:"a file already exists at that location",locked:"the destination file is locked","in-use":"the destination file is currently in use"},n=S(this.operation);return`${this.destinationPath?`Cannot ${n} "${this.sourcePath}" to "${this.destinationPath}"`:`Cannot ${n} "${this.sourcePath}"`}: ${e[this.conflictType]}.`}},R=class extends E{constructor(e,n,t){super(`Invalid path "${e}": ${n}${t?` - ${t}`:""}`);this.path=e;this.reason=n;this.details=t}getUserMessage(){let n={empty:"Path cannot be empty",absolute:"Absolute paths are not allowed",traversal:"Path traversal (../) is not allowed","invalid-characters":"Path contains invalid characters","too-long":"Path is too long","reserved-name":"Path uses a reserved system name"}[this.reason],t=this.details?` (${this.details})`:"";return`Invalid path "${this.path}": ${n}${t}.`}},I=class extends E{constructor(e,n,t){let r=S(n);super(`File operation failed: ${r} on "${e}"`);this.filePath=e;this.operation=n;this.originalError=t}getUserMessage(){var t;let e=S(this.operation),n=(t=this.originalError)!=null&&t.message?`: ${this.originalError.message}`:"";return`Failed to ${e} "${this.filePath}"${n}.`}};function C(i,o,e,n){let t=i instanceof Error?i:new Error(String(i)),r=t.message.toLowerCase();return r.includes("permission")||r.includes("eacces")||r.includes("eperm")||r.includes("access denied")?new V(o,e,t):r.includes("already exists")||r.includes("eexist")||r.includes("file exists")?new z(o,n||o,"exists",e,t):r.includes("locked")||r.includes("ebusy")?new z(o,n||o,"locked",e,t):r.includes("in use")||r.includes("being used")||r.includes("etxtbsy")?new z(o,n||o,"in-use",e,t):r.includes("invalid path")||r.includes("invalid character")||r.includes("einval")?new R(n||o,"invalid-characters"):r.includes("path too long")||r.includes("enametoolong")?new R(n||o,"too-long"):new I(o,e,t)}function S(i){return i.replace(/-/g," ")}var H=require("obsidian");var D={windows:260,unix:4096,component:255},te=new Set(["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"]),ne=/[<>:"|?*\x00-\x1F]/,se=/^([A-Za-z]:[\\/]|\/)/,ae=/(^|[\\/])\.\.($|[\\/])/,re=/\/{2,}|\\{2,}/;function P(i,o={}){let{allowEmpty:e=!1,allowAbsolute:n=!1,maxLength:t=D.windows,checkReservedNames:r=!0}=o,a=[];if(!i||i.trim().length===0)return e?{valid:!0,sanitizedPath:"",warnings:a}:{valid:!1,error:new R(i,"empty")};if(se.test(i)&&!n)return{valid:!1,error:new R(i,"absolute","Use relative paths within the vault")};if(ae.test(i))return{valid:!1,error:new R(i,"traversal",'Paths cannot contain ".." segments')};let s=(0,H.normalizePath)(i);re.test(s)&&(s=s.replace(/\/{2,}/g,"/").replace(/\\{2,}/g,"/"),a.push("Multiple consecutive slashes were normalized")),s=s.trim().replace(/^\/+|\/+$/g,"");let l=s.match(ne);if(l)return{valid:!1,error:new R(i,"invalid-characters",`Contains invalid character: "${l[0]}"`)};if(s.length>t)return{valid:!1,error:new R(i,"too-long",`Path length (${s.length}) exceeds maximum (${t})`)};let u=s.split("/").filter(Boolean);for(let d of u){if(d.length>D.component)return{valid:!1,error:new R(i,"too-long",`Path component "${d}" exceeds ${D.component} characters`)};if(r){let m=d.split(".")[0].toUpperCase();if(te.has(m))return{valid:!1,error:new R(i,"reserved-name",`"${d}" is a reserved system name on Windows`)}}if(d.endsWith(".")||d.endsWith(" "))return{valid:!1,error:new R(i,"invalid-characters",`Path component "${d}" cannot end with a dot or space`)}}return{valid:!0,sanitizedPath:s,warnings:a.length>0?a:void 0}}function L(i){return P(i,{allowEmpty:!1,allowAbsolute:!1,checkReservedNames:!0})}var ie={rules:[]},oe=[{value:"equals",label:"Equals"},{value:"contains",label:"Contains"},{value:"starts-with",label:"Starts with"},{value:"ends-with",label:"Ends with"},{value:"regex",label:"Regular expression"}];function B(i){var n,t,r,a,s,l;let o=(n=i.matchType)!=null?n:i.isRegex?"regex":"equals",e={...i,matchType:o,key:(t=i.key)!=null?t:"",value:(r=i.value)!=null?r:"",destination:(a=i.destination)!=null?a:"",enabled:(s=i.enabled)!=null?s:!1};return o==="regex"?(e.isRegex=!0,e.flags=(l=i.flags)!=null?l:""):(delete e.isRegex,"flags"in e&&delete e.flags),e}var A=class extends v.Plugin{constructor(){super(...arguments);this.rules=[];this.ruleParseErrors=[]}async onload(){await this.loadSettings(),this.updateRulesFromSettings();let e=async n=>{!(n instanceof v.TFile)||n.extension!=="md"||await this.applyRulesToFile(n)};this.registerEvent(this.app.vault.on("modify",e)),this.registerEvent(this.app.vault.on("create",e)),this.registerEvent(this.app.vault.on("rename",e)),this.registerEvent(this.app.metadataCache.on("changed",async n=>{!(n instanceof v.TFile)||n.extension!=="md"||await this.applyRulesToFile(n)})),this.addCommand({id:"obsidian-vault-organizer-apply-rules",name:"Reorganize notes based on frontmatter rules",callback:async()=>{await this.reorganizeAllMarkdownFiles()}}),this.ruleSettingTab=new N(this.app,this),this.addSettingTab(this.ruleSettingTab)}onunload(){}async loadSettings(){let e=await this.loadData(),n=Array.isArray(e==null?void 0:e.rules)?e.rules.map(B):[];this.settings={...ie,...e,rules:n}}async saveSettings(){let e=this.settings.rules.map(B);this.settings.rules=e,await this.saveData({...this.settings,rules:e})}updateRulesFromSettings(){let{rules:e,successes:n,errors:t}=K(this.settings.rules);return this.rules=e,this.ruleParseErrors=t,{successes:n,errors:t}}async persistSettingsAndRefreshRules(){var a;let{successes:e,errors:n}=this.updateRulesFromSettings(),t=_(e.map(s=>s.rule)),r=[...this.settings.rules];e.forEach((s,l)=>{r[s.index]=t[l]}),this.settings.rules=r,await this.saveSettings(),n.length&&n.forEach(s=>{let u=`Failed to parse regular expression for rule "${s.rule.key||"(unnamed rule)"}": ${s.message}`;new v.Notice(u)}),(a=this.ruleSettingTab)==null||a.refreshWarnings()}async saveSettingsWithoutReorganizing(){await this.persistSettingsAndRefreshRules()}async saveSettingsAndRefreshRules(){await this.persistSettingsAndRefreshRules(),await this.reorganizeAllMarkdownFiles()}getRuleErrorForIndex(e){return this.ruleParseErrors.find(n=>n.index===e)}async ensureFolderExists(e){if(!e||e==="."||e==="/")return;let n=P(e,{allowEmpty:!1,allowAbsolute:!1});if(!n.valid)throw n.error;let r=n.sanitizedPath.split("/").filter(Boolean);if(!r.length)return;let a="";for(let s of r)if(a=a?`${a}/${s}`:s,!this.app.vault.getAbstractFileByPath(a))try{await this.app.vault.createFolder(a)}catch(l){throw C(l,a,"create-folder")}}async applyRulesToFile(e){var r;let n=e.basename,t;try{let a=(r=this.app.metadataCache.getFileCache(e))==null?void 0:r.frontmatter;if(!a)return;let s=$.call(this,e,this.rules,a);if(!s)return;let l=s.destination.trim();if(!l){if(s.debug){let f=this.app.vault.getName();new v.Notice(`DEBUG: ${e.basename} would not be moved because destination is empty in ${f}.`)}return}let u=L(l);if(!u.valid)throw u.error;let d=u.sanitizedPath,m=P(`${d}/${e.name}`,{allowEmpty:!1,allowAbsolute:!1});if(!m.valid)throw m.error;let p=m.sanitizedPath;if(t=p,e.path===p)return;if(s.debug){let f=this.app.vault.getName();new v.Notice(`DEBUG: ${e.basename} would be moved to ${f}/${d}`);return}await this.ensureFolderExists(d);try{await this.app.fileManager.renameFile(e,p)}catch(f){throw C(f,e.path,"move",p)}}catch(a){if(a instanceof E)new v.Notice(a.getUserMessage()),console.error(`[Vault Organizer] ${a.name}:`,a.message,a);else{let s=C(a,e.path,"move",t);new v.Notice(s.getUserMessage()),console.error("[Vault Organizer] Unexpected error:",a)}}}async reorganizeAllMarkdownFiles(){var n,t;let e=(t=(n=this.app.vault).getMarkdownFiles)==null?void 0:t.call(n);if(e!=null&&e.length)for(let r of e)await this.applyRulesToFile(r)}testAllRules(){var t,r,a,s,l,u,d,m;let e=((r=(t=this.app.vault).getMarkdownFiles)==null?void 0:r.call(t))||[],n=[];for(let p of e){let f=(a=this.app.metadataCache.getFileCache(p))==null?void 0:a.frontmatter;if(!f)continue;let w=this.rules.findIndex(T=>T.enabled===!1?!1:$.call(this,p,[T],f));if(w===-1)continue;let g=this.rules[w].destination.trim();if(!g)continue;let c=L(g);if(!c.valid){n.push({file:p,currentPath:p.path,ruleIndex:w,error:c.error,warnings:c.warnings});continue}let h=(s=c.sanitizedPath)!=null?s:"",y=h?`${h}/${p.name}`:p.name,x=P(y,{allowEmpty:!1,allowAbsolute:!1,checkReservedNames:!0});if(!x.valid){let T=[...(l=c.warnings)!=null?l:[],...(u=x.warnings)!=null?u:[]];n.push({file:p,currentPath:p.path,ruleIndex:w,error:x.error,warnings:T.length?T:void 0});continue}let F=x.sanitizedPath;if(p.path!==F){let T=[...(d=c.warnings)!=null?d:[],...(m=x.warnings)!=null?m:[]];n.push({file:p,currentPath:p.path,newPath:F,ruleIndex:w,warnings:T.length?T:void 0})}}return n}},N=class extends v.PluginSettingTab{constructor(e,n){super(e,n);this.aggregatedTags=[];this.frontmatterKeys=[];this.plugin=n,this.debouncedSaveOnly=(0,v.debounce)(async()=>{await this.plugin.saveSettingsWithoutReorganizing()},300),this.refreshAggregatedTags(),this.refreshFrontmatterKeys(),this.plugin.registerEvent(this.plugin.app.metadataCache.on("resolved",()=>{this.refreshAggregatedTags(),this.refreshFrontmatterKeys()}))}scheduleSaveOnly(){this.debouncedSaveOnly()}cancelPendingSaveOnly(){this.debouncedSaveOnly.cancel()}refreshAggregatedTags(){var t,r,a;let e=new Set;((a=(r=(t=this.plugin.app.vault).getMarkdownFiles)==null?void 0:r.call(t))!=null?a:[]).forEach(s=>{let l=this.plugin.app.metadataCache.getFileCache(s);if(!l)return;let u=(0,v.getAllTags)(l);u&&u.forEach(d=>e.add(d))}),this.aggregatedTags=Array.from(e).sort((s,l)=>s.localeCompare(l))}getAggregatedTags(){return this.aggregatedTags.length||this.refreshAggregatedTags(),this.aggregatedTags}refreshFrontmatterKeys(){var t,r,a;let e=new Set;((a=(r=(t=this.plugin.app.vault).getMarkdownFiles)==null?void 0:r.call(t))!=null?a:[]).forEach(s=>{let l=this.plugin.app.metadataCache.getFileCache(s),u=l==null?void 0:l.frontmatter;u&&Object.keys(u).filter(d=>d!=="position").forEach(d=>e.add(d))}),this.frontmatterKeys=Array.from(e).sort((s,l)=>s.localeCompare(l))}getFrontmatterKeys(){return this.frontmatterKeys.length||this.refreshFrontmatterKeys(),this.frontmatterKeys}openTagPicker(e,n){if(!e.length)return;new q(this.app,e,n).open()}openFrontmatterKeyPicker(e,n){if(!e.length)return;new W(this.app,e,n).open()}toggleTagValue(e,n){let t=e.split(/\s+/).filter(Boolean);return(t.includes(n)?t.filter(s=>s!==n):[...t,n]).join(" ")}display(){let{containerEl:e}=this;e.empty(),this.refreshAggregatedTags(),this.refreshFrontmatterKeys(),this.plugin.settings.rules=this.plugin.settings.rules.map(B),this.plugin.settings.rules.forEach((n,t)=>{var b;let r=(b=n.matchType)!=null?b:"equals",a=new v.Setting(e).setName(`Rule ${t+1}`).setDesc("Destination folder is required before the rule can move files.");a.settingEl.classList.add("setting-item");let s=document.createElement("div");s.classList.add("vault-organizer-rule-message"),s.style.display="none",a.settingEl.appendChild(s);let l=()=>{var h;let g=this.plugin.settings.rules[t],c=(h=g==null?void 0:g.enabled)!=null?h:!1;a.settingEl.classList.toggle("vault-organizer-rule-disabled",!c)};a.addToggle(g=>{var c;return g.setTooltip("Activate this rule").setValue((c=n.enabled)!=null?c:!1).onChange(async h=>{let y=this.plugin.settings.rules[t];y&&(y.enabled=h,l(),this.cancelPendingSaveOnly(),await this.plugin.saveSettingsAndRefreshRules(),l())})}),a.addExtraButton(g=>g.setIcon("arrow-up").setTooltip("Move rule up").setDisabled(t===0).onClick(async()=>{if(t===0)return;let c=this.plugin.settings.rules[t];this.plugin.settings.rules[t]=this.plugin.settings.rules[t-1],this.plugin.settings.rules[t-1]=c,this.cancelPendingSaveOnly(),await this.plugin.saveSettingsWithoutReorganizing(),this.display()})),a.addExtraButton(g=>g.setIcon("arrow-down").setTooltip("Move rule down").setDisabled(t===this.plugin.settings.rules.length-1).onClick(async()=>{if(t===this.plugin.settings.rules.length-1)return;let c=this.plugin.settings.rules[t];this.plugin.settings.rules[t]=this.plugin.settings.rules[t+1],this.plugin.settings.rules[t+1]=c,this.cancelPendingSaveOnly(),await this.plugin.saveSettingsWithoutReorganizing(),this.display()}));let u=()=>{var F;let g=this.plugin.getRuleErrorForIndex(t),c=this.plugin.settings.rules[t],h=(F=c==null?void 0:c.matchType)!=null?F:"equals",y=O(h),x=c?M(c):!1;g?(s.classList.add("vault-organizer-rule-error"),s.classList.remove("vault-organizer-rule-warning"),s.textContent=`Invalid regular expression: ${g.message}`,s.style.display=""):y&&!x?(s.classList.add("vault-organizer-rule-warning"),s.classList.remove("vault-organizer-rule-error"),s.textContent="Value is required for contains/starts-with/ends-with rules.",s.style.display=""):(s.classList.remove("vault-organizer-rule-warning","vault-organizer-rule-error"),s.textContent="",s.style.display="none")},d;a.addText(g=>{d=g,g.setPlaceholder("key").setValue(n.key).onChange(c=>{let h=this.plugin.settings.rules[t];h&&(h.key=c,this.scheduleSaveOnly())})}),a.addExtraButton(g=>g.setIcon("list").setTooltip("Browse frontmatter keys").onClick(()=>{let c=this.getFrontmatterKeys();this.openFrontmatterKeyPicker(c,h=>{let y=this.plugin.settings.rules[t];!y||!d||(d.setValue(h),y.key=h,this.scheduleSaveOnly())})}));let m;a.addText(g=>{m=g,g.setPlaceholder("value").setValue(n.value).onChange(c=>{let h=this.plugin.settings.rules[t];h&&(h.value=c,this.scheduleSaveOnly(),u())})}),a.addExtraButton(g=>g.setIcon("hashtag").setTooltip("Browse tags").onClick(()=>{let c=this.getAggregatedTags();this.openTagPicker(c,h=>{let y=this.plugin.settings.rules[t];if(!y||!m)return;let x=this.toggleTagValue(m.getValue(),h);m.setValue(x),y.value=x,this.scheduleSaveOnly()})})),a.addText(g=>g.setPlaceholder("destination folder (required)").setValue(n.destination).onChange(c=>{let h=this.plugin.settings.rules[t];h&&(h.destination=c,this.scheduleSaveOnly())}));let p,f,w=()=>{var h;let g=this.plugin.settings.rules[t],c=((h=g==null?void 0:g.matchType)!=null?h:"equals")==="regex";p&&(p.inputEl.toggleAttribute("disabled",!c),p.inputEl.disabled=!c,p.inputEl.style.display=c?"":"none"),f&&(f.toggleEl.style.display=c?"none":"")};a.addDropdown(g=>{g.selectEl.setAttribute("aria-label","Match type"),oe.forEach(c=>g.addOption(c.value,c.label)),g.setValue(r).onChange(async c=>{var y;let h=this.plugin.settings.rules[t];h&&(h.matchType=c,c==="regex"?(h.isRegex=!0,h.flags=(y=h.flags)!=null?y:""):(delete h.isRegex,"flags"in h&&delete h.flags),w(),this.cancelPendingSaveOnly(),await this.plugin.saveSettingsAndRefreshRules(),w(),u())})}),a.addText(g=>{var c;p=g,g.setPlaceholder("flags").setValue((c=n.flags)!=null?c:"").onChange(h=>{let y=this.plugin.settings.rules[t];y&&y.matchType==="regex"&&(y.flags=h,this.scheduleSaveOnly())})}),w(),a.addToggle(g=>{var c;f=g,g.setTooltip("Case insensitive matching").setValue((c=n.caseInsensitive)!=null?c:!1).onChange(async h=>{let y=this.plugin.settings.rules[t];y&&(y.caseInsensitive=h,this.cancelPendingSaveOnly(),await this.plugin.saveSettingsAndRefreshRules())})}),a.addToggle(g=>{var c;return g.setTooltip("Enable debug mode").setValue((c=n.debug)!=null?c:!1).onChange(async h=>{let y=this.plugin.settings.rules[t];y&&(y.debug=h,this.cancelPendingSaveOnly(),await this.plugin.saveSettingsAndRefreshRules())})}),a.addButton(g=>g.setButtonText("Remove").onClick(async()=>{this.plugin.settings.rules.splice(t,1),this.cancelPendingSaveOnly(),await this.plugin.saveSettingsWithoutReorganizing(),this.display()})),u(),l()}),new v.Setting(e).addButton(n=>n.setButtonText("Add Rule").onClick(async()=>{this.plugin.settings.rules.push({key:"",value:"",destination:"",matchType:"equals",debug:!1,enabled:!1}),this.cancelPendingSaveOnly(),await this.plugin.saveSettingsWithoutReorganizing(),this.display()})),new v.Setting(e).addButton(n=>n.setButtonText("Apply now").onClick(async()=>{this.cancelPendingSaveOnly(),await this.plugin.saveSettingsAndRefreshRules()})).addButton(n=>n.setButtonText("Test All Rules").setTooltip("Preview what moves would be made without actually moving files").onClick(async()=>{this.cancelPendingSaveOnly(),await this.plugin.saveSettingsWithoutReorganizing();let t=this.plugin.testAllRules();new U(this.app,t,this.plugin.settings.rules).open()}))}refreshWarnings(){let{containerEl:e}=this;if(!e)return;e.querySelectorAll(".setting-item").forEach((t,r)=>{var f,w;let a=t.querySelector(".vault-organizer-rule-message");if(!a)return;let s=this.plugin.settings.rules[r],l=(f=s==null?void 0:s.enabled)!=null?f:!1;t.classList.toggle("vault-organizer-rule-disabled",!l);let u=this.plugin.getRuleErrorForIndex(r),d=(w=s==null?void 0:s.matchType)!=null?w:"equals",m=O(d),p=s?M(s):!1;u?(a.classList.add("vault-organizer-rule-error"),a.classList.remove("vault-organizer-rule-warning"),a.textContent=`Invalid regular expression: ${u.message}`,a.style.display=""):m&&!p?(a.classList.add("vault-organizer-rule-warning"),a.classList.remove("vault-organizer-rule-error"),a.textContent="Value is required for contains/starts-with/ends-with rules.",a.style.display=""):(a.classList.remove("vault-organizer-rule-warning","vault-organizer-rule-error"),a.textContent="",a.style.display="none")})}},q=class extends v.FuzzySuggestModal{constructor(e,n,t){super(e);this.tags=n;this.onSelect=t}getItems(){return this.tags}getItemText(e){return e}onChooseItem(e){this.onSelect(e)}},W=class extends v.FuzzySuggestModal{constructor(e,n,t){super(e);this.keys=n;this.onSelect=t}getItems(){return this.keys}getItemText(e){return e}onChooseItem(e){this.onSelect(e)}},U=class extends v.Modal{constructor(e,n,t){super(e);this.results=n;this.rules=t}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Test All Rules - Preview"});let n=this.results.filter(s=>s.newPath&&!s.error),t=this.results.filter(s=>s.error);if(n.length===0&&t.length===0)e.createEl("p",{text:"No files would be moved. All files are either already in the correct location or have no matching rules."});else{if(n.length){e.createEl("p",{text:`${n.length} file(s) would be moved:`});let s=e.createDiv({cls:"vault-organizer-test-results"});s.style.maxHeight="400px",s.style.overflowY="auto",s.style.marginTop="1em",n.forEach(l=>{var w,b;let u=s.createDiv({cls:"vault-organizer-test-result-item"});u.style.marginBottom="1em",u.style.padding="0.5em",u.style.border="1px solid var(--background-modifier-border)",u.style.borderRadius="4px";let d=u.createDiv();d.createEl("strong",{text:"File: "}),d.createSpan({text:l.file.basename});let m=u.createDiv();m.createEl("strong",{text:"From: "}),m.createSpan({text:l.currentPath});let p=u.createDiv();p.createEl("strong",{text:"To: "}),p.createSpan({text:l.newPath});let f=u.createDiv();if(f.createEl("strong",{text:"Rule: "}),f.createSpan({text:`Rule ${l.ruleIndex+1} (${((w=this.rules[l.ruleIndex])==null?void 0:w.key)||"unknown"})`}),(b=l.warnings)!=null&&b.length){let g=u.createDiv();g.createEl("strong",{text:"Warnings: "}),g.createSpan({text:l.warnings.join("; ")})}})}else e.createEl("p",{text:"No files would be moved. All matching files are already in the correct location."});if(t.length){e.createEl("h3",{text:"Skipped due to invalid destinations"});let s=e.createDiv({cls:"vault-organizer-test-results"});s.style.maxHeight="400px",s.style.overflowY="auto",s.style.marginTop="1em",t.forEach(l=>{var w,b,g,c;let u=s.createDiv({cls:"vault-organizer-test-result-item"});u.style.marginBottom="1em",u.style.padding="0.5em",u.style.border="1px solid var(--background-modifier-border)",u.style.borderRadius="4px";let d=u.createDiv();d.createEl("strong",{text:"File: "}),d.createSpan({text:l.file.basename});let m=u.createDiv();m.createEl("strong",{text:"From: "}),m.createSpan({text:l.currentPath});let p=u.createDiv();p.createEl("strong",{text:"Rule: "}),p.createSpan({text:`Rule ${l.ruleIndex+1} (${((w=this.rules[l.ruleIndex])==null?void 0:w.key)||"unknown"})`});let f=u.createDiv();if(f.createEl("strong",{text:"Reason: "}),f.createSpan({text:(g=(b=l.error)==null?void 0:b.getUserMessage())!=null?g:"Destination path is invalid and the move cannot be previewed."}),(c=l.warnings)!=null&&c.length){let h=u.createDiv();h.createEl("strong",{text:"Warnings: "}),h.createSpan({text:l.warnings.join("; ")})}})}}let r=e.createDiv({cls:"modal-button-container"});r.style.marginTop="1.5em",r.style.textAlign="right";let a=r.createEl("button",{text:"Close"});a.onclick=()=>this.close()}onClose(){let{contentEl:e}=this;e.empty()}};
